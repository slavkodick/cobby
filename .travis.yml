sudo: required
dist: trusty

language: php

php:
  - 7.0

env:
    - magento=2.1.6

branches:
  only:
    - master

#cache:
#  directories:
#    - $HOME/.composer/cache

before_install:
  - cd $HOME
  - composer config -g http-basic.repo.magento.com $MAGE_PUBLICKEY $MAGE_PRIVATEKEY
  - chmod +x $HOME/*

install:
  # install magento to home directory
  - cd $HOME
  - composer create-project "magento/community-edition:$magento" ce

  # install cobby
  - cd ce
  - composer require slavkodick/cobby:dev-master

  # update cs and standards
  - composer require squizlabs/php_codesniffer:*
  - composer require magento-ecg/coding-standard:*

  - composer update

script:
  # run phpcs
  - cd $HOME/ce/vendor
  - ./bin/phpcs --standard=./magento-ecg/coding-standard/EcgM2/ ./slavkodick/cobby/